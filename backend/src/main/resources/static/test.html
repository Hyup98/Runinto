<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>RunInto í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f9f9f9;
      padding: 20px;
      color: #333;
    }

    h1 {
      color: #4CAF50;
      margin-bottom: 30px;
    }

    section {
      background-color: #fff;
      border: 1px solid #ddd;
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    section h2 {
      margin-top: 0;
      color: #333;
      border-left: 5px solid #4CAF50;
      padding-left: 10px;
    }

    input, textarea, select, button {
      margin: 10px 0;
      padding: 10px;
      width: 100%;
      max-width: 500px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #45a049;
    }

    ul.chatBox {
      padding-left: 0;
      list-style: none;
    }

    ul.chatBox li {
      background: #e6f5e6;
      margin-bottom: 5px;
      padding: 8px 12px;
      border-radius: 5px;
    }
  </style>
</head>
<body>

<h1>âœ… RunInto í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>

<section>
  <h2>1. íšŒì›ê°€ì…</h2>
  <input id="userName" placeholder="ì´ë¦„">
  <input id="userEmail" placeholder="ì´ë©”ì¼">
  <input id="userPassword" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <button onclick="registerUser()">íšŒì›ê°€ì…</button>
</section>

<section>
  <h2>2. ì´ë²¤íŠ¸ ìƒì„±</h2>
  <input id="eventTitle" placeholder="ì´ë²¤íŠ¸ ì œëª©">
  <textarea id="eventDescription" placeholder="ì´ë²¤íŠ¸ ì„¤ëª…"></textarea>
  <input id="latitude" placeholder="ìœ„ë„ (ì˜ˆ: 37.5665)" type="number" step="any">
  <input id="longitude" placeholder="ê²½ë„ (ì˜ˆ: 126.9780)" type="number" step="any">
  <input id="maxParticipants" placeholder="ìµœëŒ€ ì¸ì›" type="number">
  <button onclick="createCustomEvent()">ì´ë²¤íŠ¸ ìƒì„±</button>
</section>

<section>
  <h2>3. ì´ë²¤íŠ¸ ëª©ë¡</h2>
  <button onclick="loadEvents()">ì´ë²¤íŠ¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  <ul id="eventList"></ul>
</section>

<section>
  <h2>4. ì±„íŒ…ë°© ëª©ë¡ ë° ì±„íŒ…</h2>
  <input id="eventIdForChatList" placeholder="ì´ë²¤íŠ¸ ID">
  <button onclick="loadChatroom()">ì±„íŒ…ë°© ë¶ˆëŸ¬ì˜¤ê¸°</button>
  <div id="chatroomContainer"></div>

  <section>
    <h2>ğŸ“‹ ì „ì²´ ì±„íŒ…ë°© ëª©ë¡</h2>
    <button onclick="loadAllChatrooms()">ì „ì²´ ì±„íŒ…ë°© ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <div id="allChatroomsContainer"></div>
  </section>
  <input id="eventIdForChatList" placeholder="ì´ë²¤íŠ¸ ID">
  <button onclick="loadChatroom()">ì±„íŒ…ë°© ë¶ˆëŸ¬ì˜¤ê¸°</button>
  <div id="chatroomContainer"></div>

  <section>
    <h2>ğŸ“‹ ì „ì²´ ì±„íŒ…ë°© ëª©ë¡</h2>
    <button onclick="loadAllChatrooms()">ì „ì²´ ì±„íŒ…ë°© ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <div id="allChatroomsContainer"></div>
  </section>
</section>

<script>
  const BASE_URL = "http://localhost:8080";

  function registerUser() {
    const user = {
      name: document.getElementById("userName").value,
      email: document.getElementById("userEmail").value,
      password: document.getElementById("userPassword").value,
      imgUrl: "https://example.com/img.jpg",
      description: "í…ŒìŠ¤íŠ¸ ê°€ì…ìì…ë‹ˆë‹¤",
      gender: "MALE",
      age: 20
    };

    fetch(`${BASE_URL}/users/register`, {
      method: "POST",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(user)
    })
            .then(res => res.ok ? res.json() : Promise.reject("íšŒì›ê°€ì… ì‹¤íŒ¨"))
            .then(data => alert("íšŒì›ê°€ì… ì„±ê³µ! ID: " + data.userId))
            .catch(err => alert(err));
  }

  function createCustomEvent() {
    const event = {
      title: document.getElementById("eventTitle").value,
      description: document.getElementById("eventDescription").value,
      latitude: parseFloat(document.getElementById("latitude").value),
      longitude: parseFloat(document.getElementById("longitude").value),
      maxParticipants: parseInt(document.getElementById("maxParticipants").value),
      isPublic: true
    };

    fetch(`${BASE_URL}/events`, {
      method: "POST",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(event)
    })
            .then(res => res.ok ? res.json() : Promise.reject("ì´ë²¤íŠ¸ ìƒì„± ì‹¤íŒ¨"))
            .then(data => {
              alert(`âœ… ì´ë²¤íŠ¸ ìƒì„± ì™„ë£Œ\nì´ë²¤íŠ¸ ID: ${data.eventId}\nì±„íŒ…ë°© ID: ${data.chatroomId || "ì—†ìŒ"}`);
              document.getElementById("eventIdForChatList").value = data.eventId;
              loadEvents();
            })
            .catch(err => alert(err));
  }

  function loadEvents() {
    fetch(`${BASE_URL}/events?swLat=37.4&neLat=37.7&swLng=126.8&neLng=127.2`)
            .then(res => res.json())
            .then(data => {
              const ul = document.getElementById("eventList");
              ul.innerHTML = "";

              if (data.events && data.events.length > 0) {
                data.events.forEach(event => {
                  ul.innerHTML += `<li>ğŸŸ¢ ${event.title} (ID: ${event.eventId}) - ì°¸ê°€ì: ${event.participants}/${event.maxParticipants}</li>`;
                });
              } else {
                ul.innerHTML = "<li>ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
              }
            })
            .catch(err => {
              console.error("ì´ë²¤íŠ¸ ë¡œë”© ì˜¤ë¥˜:", err);
              document.getElementById("eventList").innerHTML = "<li>ì´ë²¤íŠ¸ ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</li>";
            });
  }

  function loadChatroomId(eventId, callback) {
    fetch(`${BASE_URL}/events/${eventId}/chatroom`)
            .then(res => res.json())
            .then(data => callback(data.chatroomId))
            .catch(err => alert("ì±„íŒ…ë°© ë¡œë”© ì‹¤íŒ¨: " + err));
  }

  function loadChatroom() {
    const eventId = document.getElementById("eventIdForChatList").value;

    loadChatroomId(eventId, (chatroomId) => {
      const chatroomDivId = `chatroom-${chatroomId}`;
      if (document.getElementById(chatroomDivId)) {
        alert("ì´ë¯¸ ì—´ë ¤ìˆëŠ” ì±„íŒ…ë°©ì…ë‹ˆë‹¤.");
        return;
      }

      const container = document.getElementById("chatroomContainer");
      const chatDiv = document.createElement("div");
      chatDiv.id = chatroomDivId;
      chatDiv.style.marginTop = "20px";
      chatDiv.style.padding = "10px";
      chatDiv.style.border = "1px solid #ccc";
      chatDiv.style.borderRadius = "8px";
      chatDiv.style.backgroundColor = "#f5f5f5";

      chatDiv.innerHTML = `
        <h3>ğŸ’¬ ì±„íŒ…ë°© ID: ${chatroomId} (ì´ë²¤íŠ¸ ID: ${eventId})</h3>
        <ul id="chatMessages-${chatroomId}" class="chatBox"></ul>
        <input id="input-userId-${chatroomId}" placeholder="ìœ ì € ID">
        <input id="input-message-${chatroomId}" placeholder="ë©”ì‹œì§€ ì…ë ¥">
        <button onclick="sendChatToRoom(${eventId}, ${chatroomId})">ì „ì†¡</button>
      `;

      container.appendChild(chatDiv);

      fetch(`${BASE_URL}/events/${eventId}/chatroom/messages`)
              .then(res => res.json())
              .then(messages => {
                const ul = document.getElementById(`chatMessages-${chatroomId}`);
                ul.innerHTML = "";
                messages.forEach(msg => {
                  const li = document.createElement("li");
                  li.innerText = `[${msg.senderId}] ${msg.message}`;
                  ul.appendChild(li);
                });
              });
    });
  }

  function sendChatToRoom(eventId, chatroomId) {
    const userId = document.getElementById(`input-userId-${chatroomId}`).value;
    const message = document.getElementById(`input-message-${chatroomId}`).value;

    const payload = {
      senderId: userId,
      message: message
    };

    fetch(`${BASE_URL}/events/${eventId}/chatroom/messages`, {
      method: "POST",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    }).then(() => {
      return fetch(`${BASE_URL}/events/${eventId}/chatroom/messages`);
    }).then(res => res.json())
            .then(messages => {
              const ul = document.getElementById(`chatMessages-${chatroomId}`);
              ul.innerHTML = "";
              messages.forEach(msg => {
                const li = document.createElement("li");
                li.innerText = `[${msg.senderId}] ${msg.message}`;
                ul.appendChild(li);
              });
            });
  }

  function loadAllChatrooms() {
    fetch(`${BASE_URL}/chatrooms`)
            .then(res => res.json())
            .then(data => {
              const container = document.getElementById("allChatroomsContainer");
              container.innerHTML = "";

              const chatrooms = data || [];
              chatrooms.forEach(chatroom => {
                const chatroomId = chatroom.chatroomId;
                const eventId = chatroom.eventId;
                const chatDivId = `chatroom-${chatroomId}`;

                if (document.getElementById(chatDivId)) return;

                const chatDiv = document.createElement("div");
                chatDiv.id = chatDivId;
                chatDiv.style.marginTop = "20px";
                chatDiv.style.padding = "10px";
                chatDiv.style.border = "1px solid #ccc";
                chatDiv.style.borderRadius = "8px";
                chatDiv.style.backgroundColor = "#f5f5f5";

                chatDiv.innerHTML = `
            <h3>ğŸ’¬ ì±„íŒ…ë°© ID: ${chatroomId} (ì´ë²¤íŠ¸ ID: ${eventId})</h3>
            <ul id="chatMessages-${chatroomId}" class="chatBox"></ul>
            <input id="input-userId-${chatroomId}" placeholder="ìœ ì € ID">
            <input id="input-message-${chatroomId}" placeholder="ë©”ì‹œì§€ ì…ë ¥">
            <button onclick="sendChatToRoom(${eventId}, ${chatroomId})">ì „ì†¡</button>
          `;

                container.appendChild(chatDiv);

                fetch(`${BASE_URL}/events/${eventId}/chatroom/messages`)
                        .then(res => res.json())
                        .then(messages => {
                          const ul = document.getElementById(`chatMessages-${chatroomId}`);
                          ul.innerHTML = "";
                          messages.forEach(msg => {
                            const li = document.createElement("li");
                            li.innerText = `[${msg.senderId}] ${msg.message}`;
                            ul.appendChild(li);
                          });
                        });
              });
            })
            .catch(err => {
              console.error("ì „ì²´ ì±„íŒ…ë°© ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
            });
  }
</script>


<script>
  function loadChatroomId(eventId, callback) {
    fetch(`${BASE_URL}/events/${eventId}/chatroom`)
            .then(res => res.json())
            .then(data => callback(data.chatroomId))
            .catch(err => alert("ì±„íŒ…ë°© ë¡œë”© ì‹¤íŒ¨: " + err));
  }

  function loadChatroom() {
    const eventId = document.getElementById("eventIdForChatList").value;
    if (!eventId) return alert("ì´ë²¤íŠ¸ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

    loadChatroomId(eventId, (chatroomId) => {
      const chatroomDivId = `chatroom-${chatroomId}`;
      if (document.getElementById(chatroomDivId)) {
        alert("ì´ë¯¸ ì—´ë ¤ìˆëŠ” ì±„íŒ…ë°©ì…ë‹ˆë‹¤.");
        return;
      }

      const container = document.getElementById("chatroomContainer");
      const chatDiv = document.createElement("div");
      chatDiv.id = chatroomDivId;
      chatDiv.style.marginTop = "20px";
      chatDiv.style.padding = "10px";
      chatDiv.style.border = "1px solid #ccc";
      chatDiv.style.borderRadius = "8px";
      chatDiv.style.backgroundColor = "#f5f5f5";

      chatDiv.innerHTML = `
        <h3>ğŸ’¬ ì±„íŒ…ë°© ID: ${chatroomId} (ì´ë²¤íŠ¸ ID: ${eventId})</h3>
        <ul id="chatMessages-${chatroomId}" class="chatBox"></ul>
        <input id="input-userId-${chatroomId}" placeholder="ìœ ì € ID">
        <input id="input-message-${chatroomId}" placeholder="ë©”ì‹œì§€ ì…ë ¥">
        <button onclick="sendChatToRoom(${eventId}, ${chatroomId})">ì „ì†¡</button>
      `;

      container.appendChild(chatDiv);

      fetch(`${BASE_URL}/events/${eventId}/chatroom/messages`)
              .then(res => res.json())
              .then(messages => {
                const ul = document.getElementById(`chatMessages-${chatroomId}`);
                ul.innerHTML = "";
                messages.forEach(msg => {
                  const li = document.createElement("li");
                  li.innerText = `[${msg.senderId}] ${msg.message}`;
                  ul.appendChild(li);
                });
              });
    });
  }

  function sendChatToRoom(eventId, chatroomId) {
    const userId = document.getElementById(`input-userId-${chatroomId}`).value;
    const message = document.getElementById(`input-message-${chatroomId}`).value;

    const payload = {
      senderId: userId,
      message: message
    };

    fetch(`${BASE_URL}/events/${eventId}/chatroom/messages`, {
      method: "POST",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    }).then(() => {
      return fetch(`${BASE_URL}/events/${eventId}/chatroom/messages`);
    }).then(res => res.json())
            .then(messages => {
              const ul = document.getElementById(`chatMessages-${chatroomId}`);
              ul.innerHTML = "";
              messages.forEach(msg => {
                const li = document.createElement("li");
                li.innerText = `[${msg.senderId}] ${msg.message}`;
                ul.appendChild(li);
              });
            });
  }

  function loadAllChatrooms() {
    fetch(`${BASE_URL}/chatrooms`)
            .then(res => res.json())
            .then(data => {
              const container = document.getElementById("allChatroomsContainer");
              container.innerHTML = "";

              const chatrooms = data || [];
              chatrooms.forEach(chatroom => {
                const chatroomId = chatroom.chatroomId;
                const eventId = chatroom.eventId;
                const chatDivId = `chatroom-${chatroomId}`;

                if (document.getElementById(chatDivId)) return;

                const chatDiv = document.createElement("div");
                chatDiv.id = chatDivId;
                chatDiv.style.marginTop = "20px";
                chatDiv.style.padding = "10px";
                chatDiv.style.border = "1px solid #ccc";
                chatDiv.style.borderRadius = "8px";
                chatDiv.style.backgroundColor = "#f5f5f5";

                chatDiv.innerHTML = `
            <h3>ğŸ’¬ ì±„íŒ…ë°© ID: ${chatroomId} (ì´ë²¤íŠ¸ ID: ${eventId})</h3>
            <ul id="chatMessages-${chatroomId}" class="chatBox"></ul>
            <input id="input-userId-${chatroomId}" placeholder="ìœ ì € ID">
            <input id="input-message-${chatroomId}" placeholder="ë©”ì‹œì§€ ì…ë ¥">
            <button onclick="sendChatToRoom(${eventId}, ${chatroomId})">ì „ì†¡</button>
          `;

                container.appendChild(chatDiv);

                fetch(`${BASE_URL}/events/${eventId}/chatroom/messages`)
                        .then(res => res.json())
                        .then(messages => {
                          const ul = document.getElementById(`chatMessages-${chatroomId}`);
                          ul.innerHTML = "";
                          messages.forEach(msg => {
                            const li = document.createElement("li");
                            li.innerText = `[${msg.senderId}] ${msg.message}`;
                            ul.appendChild(li);
                          });
                        });
              });
            })
            .catch(err => {
              console.error("ì „ì²´ ì±„íŒ…ë°© ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
            });
  }
</script>
</body>
</html>
